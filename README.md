# SQaLice

## Описание и назначение

Пакет SQaLice разработан для гибкой обработки запросов к БД на PostgreSQL в проектах с применением go-swagger. SQaLice позволяет запрашивать
конкретный набор полей из установленного target, фильтровать, сортировать и ограничивать получаемый набор строк.

## Подготовка использования компилятора

В функцию-компилятор *Compile* в качестве аргумента передается __modelsMap__, содержащая информацию о полях моделей проекта, используемых для обработки целевого SQL кода.
Рекомендуется формировать данную map динамически, например в init модуля при запуске проекта, что обеспечит консистентность сгенерированных посредством go-swagger
моделей и данных, передаваемых в компилятор через map. Для этого можно использовать функцию __FormDinamicModel__. Также в этом случае в swagger-модели не должно быть вложенных моделей, иначе произойдет некорректное считывание тегов полей и ошибки формирования полей.

## Формат запроса

В случае обращения к компилятору SQaLice все параметры целевого запроса должны содержаться в аргументе __params__. В __target__ передается целевая таблица или view, к которой
осуществляется запрос и которая используется при указании динамической модели.

## Структура запроса

Аргумент __params__ при парсинге запроса внутри *Compile* разделяется на 3 блока - __fields__, __conditions__, __restrictions__.

### Пример строки, содержащей все 3 блока

```go
params := "ID,title,updatedAt?ID==10||ID==8?ID,desc,2,0"
```

В случае отсутствия необходимости в указании одного из этих блоков, приведенное форматирование должно сохраняться

### Пример строки без блока conditions

```go
params := "ID,title,updatedAt??ID,desc,2,0"
```

Запрос без указания условий в 3 блоках одновременно не рекомендуется, так как может привести к неожиданным ошибкам

## Типы математических операторов

SQaLice поддерживает следующие математические операторов

| Оператор         | SQaLice | PG    |
| ---------------- | ------- | ----- |
| РАВНО            | ==      | =     |
| НЕ РАВНО         | !=      | !=    |
| МЕНЬШЕ           | <       | <     |
| МЕНЬШЕ ИЛИ РАВНО | <=      | <=    |
| БОЛЬШЕ           | >       | >     |
| БОЛЬШЕ ИЛИ РАВНО | >=      | >=    |

### Пример строки, содержащей математический оператор

```go
params := "ID,name?ID!=10?,,2,0"
```

## Типы логических операторов

SQaLice поддерживает следующие логические операторов

| Оператор  | SQaLice   | PG    |
| --------- | --------- | ----- |
| И         | *         | AND   |
| ИЛИ       | ||        | OR    |

### Пример строки, содержащей оба оператора

```go
params := "?(ID==8*title==Тест)||ID==10?"
```